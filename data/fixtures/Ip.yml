<?php
/**
 * For each server in Server.yml defines a pool of 100 ip addreses.
 * These will be in range 10.58.1-255.100-199
 */

// get pre-definded servers
$servers = sfYaml::load(sfConfig::get('sf_data_dir') . '/fixtures/Server.yml');
if ($servers)
{
  $servers = current($servers);
}
else
{
  return;
}

echo 'Ip:' . PHP_EOL;

$subnet = 1;
foreach ($servers as $key => $server)
{
  for ($i = 100; $i < 200; $i++)
  {
    printf(' Ip_%u.%u:'         . PHP_EOL, $subnet, $i  );
    printf('  Server: %s'     . PHP_EOL, $key         );
    printf('  ip: 10.58.%u.%u'  . PHP_EOL, $subnet, $i  );
  }

  if (++$subnet > 255)
  {
    throw new OutOfBoundsException('Too many servers. Cannot allocate ip pool.');
  }
}